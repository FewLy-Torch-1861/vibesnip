{% for snippet in snippets %}
<div class="snippet-card p-4 rounded relative group fade-in" id="snippet-{{ snippet.id }}">
    <div class="flex justify-between items-start mb-2">
        <h3 class="font-bold text-accent text-lg">{{ snippet.title }}</h3>
        <span class="text-xs bg-border px-2 py-1 rounded text-text font-mono">{{ snippet.language }}</span>
    </div>
    
    <div class="relative group/code">
        {% set code_content = snippet.code or '' %}
        {% set lines = code_content.strip().splitlines()|length %}
        {% set is_long = lines > 10 %}
        
        <div class="snippet-content {% if is_long %}collapsed{% else %}mb-3{% endif %}">
            <pre class="bg-[#1e1e2e] !bg-opacity-100 rounded overflow-hidden text-sm border border-border font-mono p-0"><code class="language-{{ snippet.language }} p-4 block">{{ code_content }}</code></pre>
            {% if is_long %}
            <div class="snippet-fade"></div>
            {% endif %}
        </div>
        
        <button onclick="copyToClipboard(this)" 
                class="absolute top-2 right-2 opacity-0 group-hover/code:opacity-100 bg-accent text-bg px-2 py-1 text-xs rounded font-bold transition-opacity z-10">
            COPY
        </button>

        {% if is_long %}
        <button onclick="toggleSnippet(this)" class="text-xs text-accent hover:underline mb-3 focus:outline-none block w-full text-center">
            Show more
        </button>
        {% endif %}
    </div>

    <div class="flex justify-between items-center text-xs text-gray-400 mt-2">
        <div class="flex gap-2">
            {% for tag in snippet.tags.split(',') %}
                {% if tag.strip() %}
                <span class="before:content-['#'] hover:text-white cursor-pointer">{{ tag.strip() }}</span>
                {% endif %}
            {% endfor %}
        </div>
        <div class="flex gap-3">
            <button onclick="loadSnippet({{ snippet.id }})" 
                    class="text-accent hover:text-white hover:underline">
                [edit]
            </button>
            <button onclick="openDeleteModal({{ snippet.id }})" 
                    class="text-red-400 hover:text-red-300 hover:underline">
                [rm]
            </button>
        </div>
    </div>
</div>
{% else %}
{% if page == 1 %}
<div class="col-span-full text-center py-12 text-gray-500 border border-dashed border-border rounded">
    <p>No snippets found.</p>
    <button onclick="document.getElementById('add-form').setAttribute('open', ''); document.querySelector('input[name=\'title\']').focus();" class="mt-2 text-accent hover:underline text-sm">
        Create one?
    </button>
</div>
{% endif %}
{% endfor %}

{% if has_next %}
<div id="load-more-{{ page }}"
     class="col-span-full text-center py-4 text-gray-400 text-sm"
     hx-get="/search?q={{ q }}&page={{ page + 1 }}"
     hx-trigger="revealed"
     hx-swap="outerHTML">
    <span class="animate-pulse">Loading more snippets...</span>
</div>
{% endif %}
